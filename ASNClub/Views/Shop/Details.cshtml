@using System.Security.Claims;
@using ASNClub.ViewModels.Product;
@model ProductDetailsViewModel;
@{
    ViewBag.Title = $"{Model.Type} for {Model.Make} {Model.Model} details";
    string url = Model.ImgUrls[0];
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/elevatezoom/3.0.8/jquery.elevatezoom.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

<style>
    .image-container {
        position: relative;
        width: 120px;
        height: 120px;
        overflow: hidden;
        border-radius: 2px;
        margin-inline-end: 5px;
    }

        .image-container img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }

    #large-image-container {
        margin-right: 5px;
        position: relative;
    }

        #large-image-container::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

    .zoom-image {
        position: absolute;
        top: 0;
        left: 0;
        display: none;
        width: 100%;
        height: 100%;
        object-fit: contain;
        pointer-events: none;
        z-index: 2;
    }

    .image-container:hover .zoom-image {
        display: block;
    }

    #large-image-container {
        margin-right: 5px;
    }

    .button {
        background-color: white;
        border-radius: 5px;
    }
</style>
<section class="py-5">
    <div class="container">
        <div class="row gx-5">
            <aside class="col-lg-6">
                <div class="border rounded-4 mb-3 d-flex justify-content-center">
                    <a id="large-image-a" data-fslightbox="mygallery" class="rounded-4" target="_blank" data-type="image" href="@url">
                        <div id="large-image-container">
                            <img id="large-image" style="max-width: 100%; max-height: 100vh; margin: auto;" class="rounded-4 fit" src="@url" />
                        </div>
                        <img id="large-image-zoom" class="zoom-image" src="@url" />
                    </a>
                </div>
                <div class="d-flex justify-content-center mb-3">
                    @foreach (var item in Model.ImgUrls)
                    {
                        <div class="image-container">
                            <img src="@item" data-zoom-image="@item" onclick="toggleImageSize(this)" />
                        </div>
                    }

                </div>
            </aside>
            <main class="col-lg-6">
                <div class="ps-lg-3">
                    <h4 class="title text-dark">
                        @Model.Type for @Model.Make @Model.Model
                    </h4>
                    <div class="d-flex flex-row my-3">
                        <div class="text-warning mb-1 me-2">
                            @* Display the average rating with stars *@
                            @for (int i = 0; i < Model.Rating; i++)
                            {
                                <i class="fa fa-star"></i>
                            }
                            @if (Model.Rating % 1 > 0)
                            {
                                <i class="fas fa-star-half-alt"></i>
                            }
                            @for (int i = 0; i < 5 - Math.Ceiling(Model.Rating); i++)
                            {
                                <i class="far fa-star"></i>
                            }
                            <span class="ms-1">
                                @Model.Rating.ToString("0.0")
                            </span>
                        </div>
                        <span style="margin-right: 5px" class="text-muted"><i class="fas fa-shopping-basket fa-sm mx-1"></i>154 orders</span>

                        @if (Model.Quantity >= 3)
                        {
                            <span style="color: limegreen">In stock</span>
                        }
                        else if (Model.Quantity > 0 && Model.Quantity < 3)
                        {
                            <span style="color: orange">@Model.Quantity in stock</span>
                        }
                        else
                        {
                            <span style="color: red">Out of stock</span>
                        }

                    </div>

                    <div class="mb-3">
                        <span class="h5">@Model.Price lv</span>
                    </div>

                    <p>@Model.Description</p>

                    <div class="row">
                        <dt class="col-3">Type:</dt>
                        <dd class="col-9">@Model.Type</dd>
                        @if (Model.Color != null)
                        {
                            <dt class="col-3">Color</dt>
                            <dd class="col-9">@Model.Color</dd>
                        }

                        <dt class="col-3">Material</dt>
                        <dd class="col-9">@Model.Material</dd>
                    </div>

                    <hr />

                    <div class="row mb-4">
                        @if (Model.Color != null)
                        {
                            <div class="col-md-4 col-6">
                                <label class="mb-2">Size</label>
                                <select class="form-select border border-secondary" style="height: 35px;">
                                    <option>Small</option>
                                    <option>Medium</option>
                                    <option>Large</option>
                                </select>
                            </div>
                        }
                        <!-- col.// -->
                        <div class="col-md-4 col-6 mb-3">
                            <label class="mb-2 d-block">Quantity</label>
                            <div class="input-group mb-3" style="width: 170px;">
                                <button class="button border border-secondary px-3" type="button" id="button-addon1" data-mdb-ripple-color="dark" onclick="minusOneQuantity()">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input id="quantityText" type="text" class="form-control text-center border border-secondary" value="1" aria-label="Example text with button addon" aria-describedby="button-addon1" />
                                <button class="button border border-secondary px-3" type="button" id="button-addon2" data-mdb-ripple-color="dark" onclick="plusOneQuantity()">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    @if (Model.Quantity > 0)
                    {
                        <a href="#" class="btn btn-warning shadow-0"> Buy now </a>
                        <a href="#" class="btn btn-primary shadow-0"> <i class="me-1 fa fa-shopping-basket"></i> Add to cart </a>
                    }
                    else
                    {
                        <a asp-controller="Home" asp-action="Contact" class="btn btn-danger shadow-0">Ask for item</a>
                    }
                </div>
            </main>
        </div>
    </div>
</section>

<h2>Rate this Product</h2>
<form id="ratingForm" asp-controller="Shop" asp-action="AddRating" asp-route-id="@Model.Id">
    <select name="ratingValue" class="form-select">
        <option value="1">1 star</option>
        <option value="2">2 stars</option>
        <option value="3">3 stars</option>
        <option value="4">4 stars</option>
        <option value="5">5 stars</option>
    </select>
    <button type="submit" class="btn btn-outline-dark mt-2">Submit Rating</button>
</form>
<div class="row d-flex justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow-0 border" style="background-color: #f0f2f5;">
            <div class="card-body p-4">

                <form id="commentForm" asp-controller="Shop" asp-action="AddComment" asp-route-id="@Model.Id">
                    <div class="form-outline mb-4">
                        <h2>Comments</h2>
                        <input type="text" name="comment" class="form-control" placeholder="Type comment..." />
                        <div class="text-center" style="margin: 10px">
                            <button type="submit" class="btn btn-outline-dark mt-auto">Add Comment</button>
                        </div>
                    </div>
                </form>

                <!-- ==================================================== -->
                <!--Comments-->
                <!-- ==================================================== -->
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/elevatezoom/3.0.8/jquery.elevatezoom.min.js"></script>
<script>
    $(document).ready(function () {
        // Trigger the elevateZoom function after the page has loaded
        $('#large-image').elevateZoom();
    });
    function toggleImageSize(clickedImage) {
        var largeImage = document.getElementById("large-image");
        var previousImage = document.querySelector(".image-container img.active");
        var largeImageAnchor = document.getElementById("large-image-a");

        // Remove active class from previously active image
        if (previousImage) {
            previousImage.classList.remove("active");
        }

        // Add active class to the clicked image
        clickedImage.classList.add("active");

        // Update the large image source and zoom image
        largeImage.src = clickedImage.src;
        largeImageAnchor.href = clickedImage.src;
        $(largeImage).data('zoom-image', clickedImage.dataset.zoomImage).elevateZoom();
    }
    function minusOneQuantity() {
        var text = document.getElementById("quantityText");
        var quantity = parseInt(text.value);
        if (quantity <= 1) {
            return;
        }
        text.value = quantity - 1;
    }
    function plusOneQuantity() {
        var text = document.getElementById("quantityText");
        var quantity = parseInt(text.value);
        text.value = quantity + 1;
    }
</script>